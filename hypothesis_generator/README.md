# Hypothesis Generator (HG)
This folder contains source code responsible for generating and analyzing the hypotheses based on the machine learning based models trained on the knowledge graph (KG) constructed by the [KG Constructor](/kg_constructor).

## Directories
* <code>[./analysis](./analysis)</code>: Folder containing files used for analysing the results.
* <code>[./data](./data)</code>: Folder containing all the files used by the HG.
* <code>[./er_mlp](./er_mlp)</code>: Implementation of the multilayer perceptrion (MLP) in TensorFlow. Please refer to its own [README](./er_mlp/README.md) file for its own file structure.
* <code>[./pra](./pra)</code>: Implementation of the Path Ranking Algorithm (PRA). This model leverages random walks to train a model that learns which paths are most important in the KG when identifying whether an edge should exist. This portion of the code utilizes the [Ni et al.](https://github.com/noon99jaki/pra) implementation along with helper scripts that we have created to handle the output of the model. Please refer to its own [README](./pra/README.md) file for its own file structure.
* <code>[./run](./run)</code>: Folder containing executable schell scripts to run the experiments. Please refer to its own [README](./run/README.md) file for detailed explanation.
* <code>[./stacked](./stacked)</code>: An ensemble of the PRA and MLP using boosted decision stumps. Please refer to its own [README](./stacked/README.md) file for its own file structure.
* <code>[./utils](./utils)</code>: Folder containing utility functions.

## How to Run
Steps below describe how to replicate the results reported in the paper.

### Step 1: Update the data files.
(Optitonal) If you wish to use the new KG created in the [KG Constructor](/kg_constructor), existing data need to be removed and replaced with the new one.

```
rm -r ./data/kb/*
cp -r ../kg_constructor/output/folds ./data/kb
cp -r ../kg_constructor/output/final ./data/kb
```

### Step 2: Update the paths.
Modify the file paths in the following files to match your local settings.

* <code>./run/configuration/*/config.sh</code>: PRA related configuration files.
* <code>./run/configuration/*/er_mlp.ini</code>: MLP related configuration files.

You can run the following script to automatically update above paths according to your local path.

```
./update_paths.sh
```

### Step 3: Clean previous results.
Current <code>[output](./run/output)</code> directory consists of results used in the paper. If you wish to run the code and replicate the results, please remove all the files.

```
rm -r ./run/output/*
```

Beside the results, this repository contains the default models used in the paper. If you wish to train new models, you first need to remove these original models.

```
rm -r ./pra/model/model_instance/*
rm -r ./er_mlp/model/model_instance/*
rm -r ./stacked/model_instance/*
```

Running the toy example takes roughly 5 seconds on PRA. For MLP, running time depends on the number of epochs. To change the number of epochs, please update the configuration files at ```./run/configuration/fold_*/er_mlp.ini``` by updating the attribute ***training_epochs***.

### Step 4: Perform k-fold cross validation.
Directory [run](./run) contains multiple helper shell scripts to run the experiments using three different models mentioned in the paper: PRA, MLP, and Stacked. Running following scripts will reproduce the results in the paper.

```
cd run
./run_pra_experiments.sh
./run_er_mlp_experiments.sh
./run_stacked_experiments.sh
```

### Step 5: Generate the hypothesis.
Running the following script will train the final model and generate the hypotheses.

```
./run_final_model.sh
```

## Output
Following files and directories will be populated under the [output](./run/output)</code> directory once finished running.

* <code>[er_mlp](./run/output/er_mlp)</code>: Folder containing the MLP results.
* <code>[pra](./run/output/pra)</code>: Folder containing the PRA results.
* <code>[stacked](./run/output/stacked)</code>: Folder containing the Stacked results.
* <code>[MLP_pr.pdf](./run/output/MLP_pr.pdf)</code>: Precision-recall curve of the MLP.
* <code>[PRA_pr.pdf](./run/output/PRA_pr.pdf)</code>: Precision-recall curve of the PRA.
* <code>[Stacked_pr.pdf](./run/output/Stacked_pr.pdf)</code>: Precision-recall curve of the Stacked.
* <code>[edges_count.txt](./run/output/edges_count.txt)</code>: Paper specific input KG analysis file.
* <code>[hypotheses_confidence.txt](./run/output/hypotheses_confidence.txt)</code>: Contains all the hypotheses generated by the final model. The columns are in the following order: ***Subject***, ***Predicate***, ***Object***, ***Label*** (all 1s since we are assuming positive relationship for the hypothesis), and ***Probability*** (Value between 0 and 1 denothing how confident the final model thinks the hypothesis is true.)
* <code>[roc.pdf](./run/output/roc.pdf)</code>: Receiver operating characteristic (ROC) curve.
* <code>[test_stats.txt](./run/output/test_stats.txt)</code>: Experiment statistics of k-fold cross validation using all the models.
